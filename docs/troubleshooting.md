# 故障排除指南

## 常见问题

### 1. 网络连接问题

- 症状：无法连接到远程服务器
- 解决方案：
  - 检查API地址配置是否正确
  - 确认网络连接是否正常
  - 验证防火墙设置
  - 查看日志中的详细错误信息

### 2. 认证问题

- 症状：API密钥验证失败
- 解决方案：
  - 确认API密钥配置正确
  - 检查密钥格式
  - 验证密钥有效性
  - 检查请求头中的Authorization格式

### 3. 功能启用失败

- 症状：功能无法启用
- 解决方案：
  - 检查配置文件权限
  - 确认端口未被占用
  - 查看详细错误日志

### 4. 消息发送问题

- 症状：消息未能发送到远程服务器
- 解决方案：
  - 检查日志中的请求体内容
  - 确认远程服务器是否正常运行
  - 验证请求格式是否正确
  - 检查网络连接和防火墙设置
  - 查看线程池是否正常运行（异步消息发送）

### 5. 消息接收问题

- 症状：无法接收或显示外部消息
- 解决方案：
  - 确认HTTP服务器正常启动
  - 检查端口是否正确开放
  - 验证消息格式是否符合要求
  - 查看服务器日志中的详细错误信息

### 6. 热重载问题

- 症状：执行热重载后功能不正常
- 解决方案：
  - 检查日志中是否有错误信息
  - 确认新版本mod与旧版本兼容
  - 尝试使用 `/aetherbridge reload` 单独重载配置
  - 如果问题持续，可能需要重启服务器

## 错误信息说明

| 错误代码 | 说明 | 解决方案 |
|---------|------|---------|
| NETWORK_TIMEOUT | 连接超时 | 检查网络连接 |
| INVALID_KEY | API密钥无效 | 验证密钥配置 |
| PORT_IN_USE | 端口被占用 | 修改监听端口 |
| REQUEST_FAILED | 请求发送失败 | 检查请求格式和网络连接 |
| PARSE_ERROR | 消息解析错误 | 验证消息格式 |
| HOTRELOAD_FAILED | 热重载失败 | 检查日志并尝试重启服务器 |
| THREAD_POOL_ERROR | 线程池异常 | 检查服务器资源使用情况，可能需要重启服务器 |

## 日志位置

- Minecraft服务端：`logs/latest.log`
- Node.js服务器：`logs/error.log`

## 使用日志调试

AetherBridge提供了详细的日志记录，可以帮助您排查问题：

1. **消息发送日志**：
   - 捕获聊天消息的详细信息
   - HTTP请求的创建和发送过程
   - 远程服务器的响应状态

2. **消息接收日志**：
   - 接收到的HTTP请求详情
   - 消息解析和处理过程
   - 广播到服务器的结果

3. **错误和异常日志**：
   - 网络连接错误
   - 消息处理异常
   - 服务器状态问题

4. **热重载日志**：
   - 功能禁用和启用过程
   - 配置重新加载状态
   - 初始化错误信息

查看这些日志可以帮助您快速定位问题所在。

## 热重载最佳实践

1. **备份原始文件**：在替换mod文件前，先备份原始文件
2. **检查版本兼容性**：确保新版本与当前服务器版本兼容
3. **替换文件时机**：在服务器负载较低时执行热重载
4. **执行顺序**：
   - 替换mod文件
   - 执行 `/aetherbridge hotreload` 命令
   - 检查日志确认重载成功
5. **回滚准备**：如果热重载失败，准备好恢复原始文件并重启服务器

## 获取帮助

1. 使用 `/aetherbridge info` 命令查看当前配置
2. 检查服务器日志获取详细错误信息
3. 提交Issue获取支持：[GitHub Issues](https://github.com/DevCL/aetherbridge/issues)

## 性能优化

### 异步消息处理

AetherBridge使用异步方式处理消息发送，以避免阻塞游戏主线程：

1. **线程池管理**：
   - 模组使用固定大小的线程池处理消息发送
   - 默认线程池大小为3，适合大多数服务器
   - 如果遇到高并发情况，可能需要调整线程池大小

2. **故障排除**：
   - 如果消息发送延迟过高，检查服务器CPU使用率
   - 如果线程池出现异常，可能需要重启服务器
   - 热重载会自动重置线程池，可用于解决部分线程相关问题

3. **日志监控**：
   - 异步消息发送的状态会记录在日志中
   - 可通过日志查看消息处理队列状态
   - 重试机制会自动处理临时网络问题

4. **优化建议**：
   - 如果消息发送延迟过高，考虑增加线程池大小
   - 如果服务器资源使用率过高，考虑升级硬件或优化配置
   - 如果网络连接不稳定，考虑优化网络设置或使用更稳定的网络
   - 如果消息处理异常频繁，检查服务器日志中的详细信息

3. 提交Issue获取支持：[GitHub Issues](https://github.com/DevCL/aetherbridge/issues) 